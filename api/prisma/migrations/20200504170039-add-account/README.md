# Migration `20200504170039-add-account`

This migration has been generated by Vincent Poulain at 5/4/2020, 5:00:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "renga"."Account" (
    "auth0id" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "email" text  NOT NULL ,
    "id" SERIAL,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
)

ALTER TABLE "renga"."Renga" DROP COLUMN "userId";

ALTER TABLE "renga"."User" ADD COLUMN "accountId" integer   ;

CREATE UNIQUE INDEX "Account.auth0id" ON "renga"."Account"("auth0id")

ALTER TABLE "renga"."User" ADD FOREIGN KEY ("accountId")REFERENCES "renga"."Account"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200429142252-add-renga-count..20200504170039-add-account
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -66,18 +66,29 @@
   @@index([userId], name: "Hint_User_fkey")
 }
 model User {
+  id         Int          @default(autoincrement()) @id
+  createdAt  DateTime     @default(now())
+  updatedAt  DateTime     @updatedAt
+  username   String
+  party      Party        @relation(fields: [partyId], references: [id])
+  partyId    String
+  score      Int          @default(0)
+  rengas     Renga[]
+  hintCount  Int          @default(3)
+  likes      Renga[]      @relation("likes", references: [id])
+  account    Account?      @relation(fields: [accountId], references: [id])
+  accountId  Int?
+}
+
+model Account {
   id        Int      @default(autoincrement()) @id
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
-  username  String
-  party     Party    @relation(fields: [partyId], references: [id])
-  partyId   String
-  score     Int      @default(0)
-  rengas    Renga[]
-  hintCount Int      @default(3)
-  likes     Renga[]  @relation("likes", references: [id])
+  auth0id   String   @unique
+  players   User[]
+  email     String
 }
 model Submission {
   id         Int      @default(autoincrement()) @id
```
