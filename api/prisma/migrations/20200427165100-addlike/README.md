# Migration `20200427165100-addlike`

This migration has been generated by Vincent Poulain at 4/27/2020, 4:51:00 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "renga"."Party" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "renga"."Movie" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "genres" integer []  ,
    "id" SERIAL,
    "movieDBId" integer  NOT NULL ,
    "title" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    "year" integer  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "renga"."Renga" (
    "authorId" integer  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "deletedAt" timestamp(3)   ,
    "emojis" text []  ,
    "id" SERIAL,
    "likeCount" integer  NOT NULL DEFAULT 0,
    "movieId" integer  NOT NULL ,
    "partyId" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    "userId" integer   ,
    PRIMARY KEY ("id")
)

CREATE TABLE "renga"."Hint" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" SERIAL,
    "rengaId" integer  NOT NULL ,
    "type" "HintType" NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "renga"."User" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "hintCount" integer  NOT NULL DEFAULT 3,
    "id" SERIAL,
    "partyId" text  NOT NULL ,
    "score" integer  NOT NULL DEFAULT 0,
    "updatedAt" timestamp(3)  NOT NULL ,
    "username" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "renga"."Submission" (
    "authorId" integer  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" SERIAL,
    "movieDBId" integer  NOT NULL ,
    "movieTitle" text  NOT NULL ,
    "rengaId" integer  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    "valid" boolean  NOT NULL DEFAULT false,
    PRIMARY KEY ("id")
)

CREATE TABLE "renga"."_likes" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL
)

CREATE UNIQUE INDEX "_likes_AB_unique" ON "renga"."_likes"("A","B")

CREATE  INDEX "_likes_B_index" ON "renga"."_likes"("B")

ALTER TABLE "renga"."Renga" ADD FOREIGN KEY ("movieId")REFERENCES "renga"."Movie"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "renga"."Renga" ADD FOREIGN KEY ("authorId")REFERENCES "renga"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "renga"."Renga" ADD FOREIGN KEY ("partyId")REFERENCES "renga"."Party"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "renga"."Hint" ADD FOREIGN KEY ("userId")REFERENCES "renga"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "renga"."Hint" ADD FOREIGN KEY ("rengaId")REFERENCES "renga"."Renga"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "renga"."User" ADD FOREIGN KEY ("partyId")REFERENCES "renga"."Party"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "renga"."Submission" ADD FOREIGN KEY ("authorId")REFERENCES "renga"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "renga"."Submission" ADD FOREIGN KEY ("rengaId")REFERENCES "renga"."Renga"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "renga"."_likes" ADD FOREIGN KEY ("A")REFERENCES "renga"."Renga"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "renga"."_likes" ADD FOREIGN KEY ("B")REFERENCES "renga"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200424195917-add-date-to-hint..20200427165100-addlike
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -38,8 +38,11 @@
   author      User         @relation(fields: [authorId], references: [id])
   authorId    Int
   party       Party        @relation(fields: [partyId], references: [id])
   partyId     String
+  likedBy     User[]       @relation("likes", references: [id])
+  likeCount   Int          @default(0)
+  userId      Int?
 }
 enum HintType {
   TIMELINE
@@ -47,16 +50,16 @@
   GENRES
 }
 model Hint {
-  id      Int      @default(autoincrement()) @id
+  id        Int      @default(autoincrement()) @id
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
-  user    User     @relation(fields: [userId], references: [id])
-  userId  Int
-  renga   Renga    @relation(fields: [rengaId], references: [id])
-  rengaId Int
-  type    HintType
+  user      User     @relation(fields: [userId], references: [id])
+  userId    Int
+  renga     Renga    @relation(fields: [rengaId], references: [id])
+  rengaId   Int
+  type      HintType
 }
 model User {
   id        Int      @default(autoincrement()) @id
@@ -67,8 +70,9 @@
   partyId   String
   score     Int      @default(0)
   rengas    Renga[]
   hintCount Int      @default(3)
+  likes     Renga[]  @relation("likes", references: [id])
 }
 model Submission {
   id         Int      @default(autoincrement()) @id
```
